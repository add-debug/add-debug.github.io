<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Quiz com API</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right, #ffe4e9, #fff0f5);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

.quiz-box {
  background: white;
  padding: 25px;
  border: 2px solid #ff99aa;
  border-radius: 15px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.1);
  max-width: 500px;
  width: 100%;
  transition: transform 0.3s ease;
  text-align: center;
}

.quiz-box:hover {
  transform: scale(1.01);
}

h1 {
  font-family: 'Pacifico', cursive;
  font-style: italic;
  font-size: 32px;
  color: #cc3366;
  margin-bottom: 5px;
}

h2 {
  color: #cc3366;
  font-size: 26px;
  margin-bottom: 10px;
}

#pergunta {
  margin: 20px 0 10px;
  font-size: 18px;
  color: #444;
}

.opcao-btn {
  display: block;
  margin: 8px 0;
  padding: 10px;
  border: none;
  border-radius: 8px;
  width: 100%;
  cursor: pointer;
  background: #0077cc;
  color: white;
  font-size: 16px;
  transition: background 0.3s ease, transform 0.2s ease;
}

.opcao-btn:hover {
  background: #005fa3;
  transform: scale(1.02);
}

.btn-vermelho {
  background: #cc0000;
  margin-top: 20px;
}

.btn-vermelho:hover {
  background: #990000;
}

#resultado {
  margin-top: 15px;
  font-weight: bold;
  text-align: center;
  font-size: 17px;
  color: #333;
}

#contador {
  margin-top: 15px;
  text-align: center;
  font-size: 17px;
  color: #555;
}

.pulso {
  animation: pulso 0.6s ease;
}

@keyframes pulso {
  0% { transform: scale(1); color: #555; }
  50% { transform: scale(1.3); color: #cc3366; }
  100% { transform: scale(1); color: #555; }
}
#resetBtn {
  background: #ffcc00;
  color: #333;
  margin-top: 10px;
}

#resetBtn:hover {
  background: #e6b800;
}
#timer {
  font-size: 16px;
  color: #cc3366;
  text-align: center;
  margin-top: 10px;
}

  </style>
</head>
<body>
  <div class="quiz-box">
    <h1>Control+Quiz</h1>
    <p id="timer">‚è±Ô∏è Tempo restante: 15s</p>
    <button class="opcao-btn" id="iniciarBtn">Iniciar Quiz</button>
	<button class="opcao-btn" id="reiniciarBtn" style="display:none;">üîÅ Reiniciar Quiz</button>
	<button class="opcao-btn" id="voltarBtn" style="display:none;">üè† Voltar √† Tela Inicial</button>
	
    <p id="pergunta" style="display:none;">Carregando pergunta...</p>
    <div id="opcoes"></div>
    <button class="opcao-btn btn-vermelho" id="novoBtn" style="display:none;">Nova Pergunta</button>
	<button class="opcao-btn btn-vermelho" id="resetBtn">üîÑ Resetar Quiz</button>
    <p id="resultado"></p>
    <div id="contador" style="display:none;">
      <span id="acertosContador">‚úÖ Acertos: 0</span> |
      <span id="errosContador">‚ùå Erros: 0</span>
    </div>
  </div>

  <script>
const perguntasUsadas = new Set();

let acertos = 0;
let erros = 0;
let totalPerguntas = 0;
const limitePerguntas = 20;

document.getElementById("iniciarBtn").addEventListener("click", () => {
  document.getElementById("iniciarBtn").style.display = "none";
  document.getElementById("pergunta").style.display = "block";
  document.getElementById("novoBtn").style.display = "inline-block";
  document.getElementById("contador").style.display = "block";
  carregarPergunta();
});

document.getElementById("novoBtn").addEventListener("click", () => {
  if (totalPerguntas < limitePerguntas) {
    carregarPergunta();
  }
});

document.getElementById("reiniciarBtn").addEventListener("click", reiniciarQuiz);
document.getElementById("voltarBtn").addEventListener("click", voltarInicio);

async function carregarPergunta() {
  document.getElementById("pergunta").innerText = "Carregando pergunta...";
  document.getElementById("opcoes").innerHTML = "";
  document.getElementById("resultado").innerText = "";

  try {
    const resposta = await fetch("https://tryvia.ptr.red/api.php?amount=1&category=18");
    const dados = await resposta.json();

    if (!dados || !dados.results || dados.results.length === 0) {
      document.getElementById("pergunta").innerText = "N√£o foi poss√≠vel carregar pergunta.";
      return;
    }

    const perguntaObj = dados.results[0];
    document.getElementById("pergunta").innerHTML = decodeHtml(perguntaObj.question);

    let opcoes = [...perguntaObj.incorrect_answers, perguntaObj.correct_answer];
    opcoes.sort(() => Math.random() - 0.5);

    const opcoesDiv = document.getElementById("opcoes");
    opcoes.forEach(op => {
      const btn = document.createElement("button");
      btn.className = "opcao-btn";
      btn.innerText = decodeHtml(op);
      btn.onclick = () => {
        totalPerguntas++;
        if (op === perguntaObj.correct_answer) {
          acertos++;
          document.getElementById("resultado").innerHTML = `‚úÖ Acertou!`;
          atualizarContadores("acertosContador");
        } else {
          erros++;
          document.getElementById("resultado").innerHTML =
            `‚ùå Errou!<br>Resposta certa: ${decodeHtml(perguntaObj.correct_answer)}`;
          atualizarContadores("errosContador");
	clearInterval(intervaloTimer);
        }

        if (totalPerguntas >= limitePerguntas) {
          encerrarQuiz();
        }
      };
      opcoesDiv.appendChild(btn);
    });

  } catch (erro) {
    console.error("Erro ao buscar API:", erro);
    document.getElementById("pergunta").innerText = "Erro ao carregar pergunta.";
  }
}

function decodeHtml(html) {
  const txt = document.createElement("textarea");
  txt.innerHTML = html;
  return txt.value;
}

function atualizarContadores(id) {
  document.getElementById("acertosContador").innerText = `‚úÖ Acertos: ${acertos}`;
  document.getElementById("errosContador").innerText = `‚ùå Erros: ${erros}`;

  const el = document.getElementById(id);
  el.classList.remove("pulso");
  void el.offsetWidth;
  el.classList.add("pulso");
}

function encerrarQuiz() {
  document.getElementById("pergunta").innerText = "üêÆ Parab√©ns! Voc√™ completou o quiz!";
  document.getElementById("opcoes").innerHTML = "";
  document.getElementById("novoBtn").style.display = "none";
  document.getElementById("reiniciarBtn").style.display = "inline-block";
  document.getElementById("voltarBtn").style.display = "inline-block";
}

function reiniciarQuiz() {
  acertos = 0;
  erros = 0;
  totalPerguntas = 0;
  document.getElementById("reiniciarBtn").style.display = "none";
  document.getElementById("voltarBtn").style.display = "none";
  document.getElementById("resultado").innerText = "";
  atualizarContadores();
  carregarPergunta();
  document.getElementById("novoBtn").style.display = "inline-block";
}

function voltarInicio() {
  location.reload();
}
document.getElementById("resetBtn").addEventListener("click", resetarQuiz);

function resetarQuiz() {
  acertos = 0;
  erros = 0;
  totalPerguntas = 0;
  indiceAtual = 0; // se estiver usando perguntas fixas

  document.getElementById("resultado").innerText = "";
  document.getElementById("opcoes").innerHTML = "";
  document.getElementById("pergunta").innerText = "Quiz reiniciado!";
  atualizarContadores();

  document.getElementById("novoBtn").style.display = "inline-block";
  document.getElementById("reiniciarBtn").style.display = "none";
  document.getElementById("voltarBtn").style.display = "none";
}

function atualizarTimer() {
  document.getElementById("timer").innerText = `‚è±Ô∏è Tempo restante: ${tempoRestante}s`;
}

async function carregarPergunta() {
  clearInterval(intervaloTimer); // limpa timer anterior
  tempoRestante = 15;
  atualizarTimer();

  intervaloTimer = setInterval(() => {
    tempoRestante--;
    atualizarTimer();

    if (tempoRestante <= 0) {
      clearInterval(intervaloTimer);
      document.getElementById("resultado").innerHTML = "‚è∞ Tempo esgotado!";
      erros++;
      atualizarContadores("errosContador");
      document.getElementById("opcoes").innerHTML = ""; // desativa op√ß√µes
    }
  }, 1000);

  document.getElementById("pergunta").innerText = "Carregando pergunta...";
  document.getElementById("opcoes").innerHTML = "";
  document.getElementById("resultado").innerText = "";

  try {
    const resposta = await fetch("https://opentdb.com/api.php?amount=10");
    const dados = await resposta.json();

    if (!dados || !dados.results || dados.results.length === 0) {
      document.getElementById("pergunta").innerText = "N√£o foi poss√≠vel carregar pergunta.";
      return;
    }

    const perguntaObj = dados.results[0];
    document.getElementById("pergunta").innerHTML = decodeHtml(perguntaObj.question);

    let opcoes = [...perguntaObj.incorrect_answers, perguntaObj.correct_answer];
    opcoes.sort(() => Math.random() - 0.5);

    const opcoesDiv = document.getElementById("opcoes");
    opcoes.forEach(op => {
      const btn = document.createElement("button");
      btn.className = "opcao-btn";
      btn.innerText = decodeHtml(op);
      btn.onclick = () => {
        clearInterval(intervaloTimer);
        totalPerguntas++;
        if (op === perguntaObj.correct_answer) {
          acertos++;
          document.getElementById("resultado").innerHTML = `‚úÖ Acertou!`;
          atualizarContadores("acertosContador");
        } else {
          erros++;
          document.getElementById("resultado").innerHTML =
            `‚ùå Errou!<br>Resposta certa: ${decodeHtml(perguntaObj.correct_answer)}`;
          atualizarContadores("errosContador");
        }

        if (totalPerguntas >= limitePerguntas) {
          encerrarQuiz();
        }
      };
      opcoesDiv.appendChild(btn);
    });

  } catch (erro) {
    console.error("Erro ao buscar API:", erro);
    document.getElementById("pergunta").innerText = "Erro ao carregar pergunta.";
  }
}

let tempoRestante = 15;
let intervaloTimer;
 
async function carregarPergunta() {
  clearInterval(intervaloTimer);
  tempoRestante = 15;
  atualizarTimer();

  intervaloTimer = setInterval(() => {
    tempoRestante--;
    atualizarTimer();

    if (tempoRestante <= 0) {
      clearInterval(intervaloTimer);
      document.getElementById("resultado").innerHTML = "‚è∞ Tempo esgotado!";
      erros++;
      atualizarContadores("errosContador");
      document.getElementById("opcoes").innerHTML = "";
    }
  }, 1000);

  document.getElementById("pergunta").innerText = "Carregando pergunta...";
  document.getElementById("opcoes").innerHTML = "";
  document.getElementById("resultado").innerText = "";

  let perguntaObj;
  let tentativa = 0;

  do {
    try {
      const resposta = await fetch(`https://opentdb.com/api.php?amount=10&nocache=${Date.now()}`);
      const dados = await resposta.json();

      if (!dados || !dados.results || dados.results.length === 0) {
        document.getElementById("pergunta").innerText = "N√£o foi poss√≠vel carregar pergunta.";
        return;
      }

      perguntaObj = dados.results[0];
      tentativa++;

    } catch (erro) {
      console.error("Erro ao buscar API:", erro);
      document.getElementById("pergunta").innerText = "Erro ao carregar pergunta.";
      return;
    }

  } while (perguntasUsadas.has(perguntaObj.question) && tentativa < 5);

  perguntasUsadas.add(perguntaObj.question);
  document.getElementById("pergunta").innerHTML = decodeHtml(perguntaObj.question);

  let opcoes = [...perguntaObj.incorrect_answers, perguntaObj.correct_answer];
  opcoes.sort(() => Math.random() - 0.5);

  const opcoesDiv = document.getElementById("opcoes");
  opcoes.forEach(op => {
    const btn = document.createElement("button");
    btn.className = "opcao-btn";
    btn.innerText = decodeHtml(op);
    btn.onclick = () => {
      clearInterval(intervaloTimer);
      totalPerguntas++;
      if (op === perguntaObj.correct_answer) {
        acertos++;
        document.getElementById("resultado").innerHTML = `‚úÖ Acertou!`;
        atualizarContadores("acertosContador");
      } else {
        erros++;
        document.getElementById("resultado").innerHTML =
          `‚ùå Errou!<br>Resposta certa: ${decodeHtml(perguntaObj.correct_answer)}`;
        atualizarContadores("errosContador");
      }

      if (totalPerguntas >= limitePerguntas) {
        encerrarQuiz();
      }
    };
    opcoesDiv.appendChild(btn);
  });
}


</script>
</body>
</html>
